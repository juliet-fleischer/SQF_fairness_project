
%----------------------------------------------------------------------------------------
%	PACKAGES AND THEMES
%----------------------------------------------------------------------------------------

\documentclass[aspectratio=169]{beamer}
\mode<presentation> {
	
	\usetheme{Boadilla}
}
\definecolor{lmugreen}{RGB}{0, 136, 58}
\usecolortheme[named=lmugreen]{structure}
\usepackage{graphicx} % Allows including images
\usepackage{booktabs} % Allows the use of \toprule, \midrule and \bottomrule in tables
% \usepackage[english]{babel}
\usepackage[ngerman]{babel}  % Load German language support
\usepackage[utf8]{inputenc}
\usepackage{amsmath,amssymb} % math symbols
\usepackage{graphicx}
\usepackage{float}
\usepackage{tikz} % for DAGs
\usetikzlibrary{positioning, arrows, arrows.meta}
\usepackage{hyperref} % for URLs
\newcommand{\gray}{\rowcolor[gray]{.90}}
\usepackage{verbatim}
\usepackage{textpos} % logo position
\usepackage[default]{sourcesanspro} % font type
\usepackage{cases} % math cases

% Caption
\usepackage{caption}
\DeclareCaptionFont{tiny}{\tiny}
\captionsetup{font=scriptsize,labelfont=scriptsize,justification=centering}

% ToC
\AtBeginSection[]{
	\begin{frame}[noframenumbering, plain]
	\frametitle{Agenda}
	\setcounter{tocdepth}{1}
	\tableofcontents[currentsection]
\end{frame}
}

% Remove navigation 
\beamertemplatenavigationsymbolsempty

% R 
\usepackage{listings}
\lstset{
language=R,
basicstyle=\scriptsize\ttfamily,
commentstyle=\ttfamily\color{gray},
backgroundcolor=\color{white},
showspaces=false,
showstringspaces=false,
showtabs=false,
tabsize=2,
captionpos=b,
breaklines=false,
breakatwhitespace=false,
title=\lstname,
escapeinside={},
keywordstyle={},
morekeywords={}, 
belowskip = -1.2 \baselineskip,
}

%----------------------------------------------------------------------------------------
%	TITLE PAGE
%----------------------------------------------------------------------------------------

\addtobeamertemplate{frametitle}{}{%
	\begin{textblock*}{100mm}(0.88\textwidth,-0.5cm)
		\includegraphics[height=1cm,width=2cm]{../figures/lmu_logo}
\end{textblock*}}

%\includegraphics[width=0.3\textwidth]{lmu_logo}
\vspace*{-1cm}

\title{Fair Machine Learning} 

\author{Juliet Fleischer} % Your name
\institute[LMU]{LMU} % Your institution as it will appear on the bottom of every slide, may be shorthand to save space
{

}
\begin{document}

{
\usebackgroundtemplate{\includegraphics[width=\paperwidth]{../figures/lmu-background.pdf}}
\begin{frame}
\begin{columns}
	\begin{column}{0.4\textwidth}
		\vspace{3cm}
		
		\textbf{\textcolor{white}{\Large Fair Machine Learning}}
		\vspace{1cm}
		
		\textcolor{white}{\footnotesize Juliet Fleischer \\
			\today}
	\end{column}
	\begin{column}{0.49\textwidth}
		\vspace{2cm}
		\begin{center}
			\includegraphics[width=0.55\textwidth]{../figures/fairness_title.jpg}
		\end{center}
	\end{column}
\end{columns}
\end{frame}
}
%----------------------------------------------------------------------------------------
%	PRESENTATION SLIDES
%----------------------------------------------------------------------------------------




\begin{frame}{Ist die Entscheidung zur Festnahme fair?}
    % Full-width text
    \begin{itemize}
        \item Trainingsdaten: SQF Daten von NYPD aus 2023 mit 16,924 Stopps
        \item Zielvariable: Festnahme \cite{Badr2022DTFANSP} (0 = keine Festnahme, 1 = Festnahme) 
        \item \textbf{Protected Attribute}: Ethnie
    \end{itemize}

    \vspace{0.5cm} % Adds some space between the text and the table/image

    % Lower half: columns for table and image
    \begin{columns}[c] % [c] centers the columns vertically
        % First column: Table
        \begin{column}{0.5\textwidth}
            \centering
            \scalebox{0.9}{ % Scale the table
                \begin{tabular}{ll}
                    \toprule
                    race & prop\\
                    \midrule
                    \color{orange}{BLACK} & 58.61\%\\
                    \color{orange}{WHITE HISPANIC} & 20.32\%\\
                    \color{orange}{BLACK HISPANIC} & 10.13\%\\
                    WHITE & 5.48\%\\
                    OTHER & 2.67\%\\
                    NA & 2.79\%\\
                    \bottomrule
                \end{tabular}
            }
        \end{column}

        % Second column: Image
        \begin{column}{0.5\textwidth}
            \centering
            \includegraphics[width=0.8\textwidth]{}
        \end{column}
    \end{columns}
\end{frame}



\section{Quellen von Bias}
% Quellen von Bias
\begin{frame}{Woher kommt Bias?}
	% insert an image
	\begin{figure}
		\centering
		\includegraphics[width=0.7\textwidth]{../figures/bias_loop.png}
		\caption{Quellen von Bias in Machine Learning Modellen \cite{mehrabi2022}}
	\end{figure}
\end{frame}



\section{Gruppen Fairness}
% Gruppen Fairness - Independence
\begin{frame}[t]{Gleiche Vorhersageraten zwischen Gruppen sind fair} % [t] aligns content at the top
    \vspace*{0.3cm} % Adds small space below the title (optional)
	\begin{table}
        \begin{tabular}{lll}
            \toprule
            \color{orange}{Independence} & Separation & Sufficiency \\
            \midrule
            \color{orange}{$\hat{Y} \perp A$} & $\hat{Y} \perp A | Y$ & $Y \perp A | \hat{Y}$\\
            \bottomrule
        \end{tabular}
    \end{table}
	\begin{itemize}
		\item Verständnis von Fairness: Personen erfahren aufgrund ihrer Gruppenzugehörigkeit Diskriminierung
		\item Vorhersageraten zwischen Gruppen sollen gleich sein
	\end{itemize}
	z.B. Statistical Parity \cite{verma2018} \\
	$$P(\hat{Y} = 1 | A = a) = P(\hat{Y} = 1 | A = b)$$
\end{frame}

% Gruppen Fairness - Separation
\begin{frame}[t]{Fairness anhand der Fehlermatrix konstruieren}
	\vspace*{0.3cm} % Adds small space below the title (optional)
	\begin{table}
        \begin{tabular}{lll}
            \toprule
            Independence & \color{blue}{Separation} & \color{red}{Sufficiency} \\
            \midrule
            $\hat{Y} \perp A$ & \color{blue}{$\hat{Y} \perp A | Y$} & \color{red}{$Y \perp A | \hat{Y}$}\\
            \bottomrule
        \end{tabular}
    \end{table}
	\begin{columns}
		\column{0.5\textwidth}
		\raggedright  % Left-aligns text
		\text{Separation:}
		\begin{itemize}
			\item Fokus auf gleichen Fehlerraten zwischen Gruppen, z.B. Predictive Equality \cite{verma2018}
		\end{itemize}
		$P(\hat{Y} = 1 | A = a, Y = 0) = P(\hat{Y} = 1 | A = b, Y = 0)$\\
		\text{Sufficiency:}
		\begin{itemize}
			\item Zuverlässigkeit der Vorhersage soll gleich sein, z.B. Predictive Parity \cite{verma2018}
		\end{itemize}
		$P(Y = 1 | A = a, \hat{Y} = 1) = P(Y = 1 | A = b, \hat{Y} = 1)$
		\column{0.5\textwidth}
		\begin{center}
			\renewcommand{\arraystretch}{1.5}  % Increase row height for a more square-like appearance
			\begin{tabular}{c|c|c|}
				& \color{blue}\(Y = 0\) & \color{blue}\(Y = 1\) \\
				\hline
				\color{red}\(\hat{Y} = 0\) & TN & FN \\
				\hline
				\color{red}\(\hat{Y} = 1\) & FP & TP \\
				\hline
			\end{tabular}
		\end{center}
	\end{columns}
\end{frame}



%Gruppen Fairness - Sufficiency
\begin{frame}[t]{Zahlreiche Variationen von Gruppen-Metriken}
	\vspace*{0.3cm} % Adds small space below the title (optional)
	\begin{table}
		\begin{tabular}{lll}
			\toprule
			Independence & Separation & \color{orange}{Sufficiency} \\
			\midrule
			$\hat{Y} \perp A$ & $\hat{Y} \perp A | Y$ & \color{orange}{$Y \perp A | \hat{Y}$}\\
			\bottomrule
		\end{tabular}
	\end{table}
	\begin{itemize}
		\item Sowohl Separation als auch Sufficiency können statt mit $\hat{Y}$ auch mit S definiert werden, z.B. Calibration 	$$P(Y = 1 | A = a, S = s) = P(Y = 1 | A = b, S = s)$$
		\item oder Well-calibration $$P(Y = 1 | A = a, S = s) = P(Y = 1 | A = b, S = s) = s$$
	\end{itemize}

\end{frame}

\begin{frame}{Gruppenmetriken im Überblick}
	\begin{itemize}
		\item Sufficiency nimmt Perspektive des Entscheidenden an
		\item Separation gut, wenn Y durch einen objektiv wahren Prozess entstanden ist
		\item Independence gut, wenn Form der Gleicheit erzwungen werden soll \cite{castelnovo2022}
	\end{itemize}
	\vspace*{0.5cm}
	\centering
	$\rightarrow$ normalerweise nicht miteinander vereinbar
\end{frame}


\section{Individuelle Fairness}
% Individuelle Fairness
\begin{frame}
    \frametitle{Gleicheit innerhalb der Gruppe vor Gleicheit zwischen Gruppen}
	\begin{itemize}
		\item Verständnis von Fairness: Fairness bedeutet, dass gleiche Personen gleich behandelt werden
	\end{itemize}
    \begin{enumerate}
		\item Fairness through Awareness (FTA)
        \begin{itemize}
            \item Lipschitz-Kriterium\cite{castelnovo2022}:
            \[
            d_Y(\hat{y_i}, \hat{y_j}) \leq \lambda {\color{orange}{d_X}}(x_i, x_j)
            \] 
            \item Definition des {\color{orange}Distanzmaßes $d_X$} im Feature Space ist eine Herausforderung
        \end{itemize}

        \item Fairness through Unawareness (FTU) = Blinding
        \begin{itemize}
            \item Vorgehensvorschrift: PA soll nicht im Entscheidungsprozess verwendet werden
            \item Keine eindeutige mathematische Definition, sondern verschiedene Ansätze zum Testen von FTU
            \item Problem der \textbf{Proxis} (Variablen, die mit PA hoch korreliert sind)
        \end{itemize}
    \end{enumerate}
\end{frame}


\section{Fairness Methoden}
% Fairness Methoden
\begin{frame}
	\frametitle{Wie sorgen wir für algorithmische Fairness?}
	\begin{itemize}
		\item Preprocessing \cite{caton2024}: Daten vor dem Training bearbeiten \\ z.B. (Re-)Sampling, Transformation
		\item Inprocessing: Trainingsprozess anpassen, Optimierungsproblem modifizieren \\ z.B.Regulasierung
		\item Postprocessing:Vorhersagen nach dem Training bearbeiten \\ z.B. Thresholding
		\item Interpretable ML Methoden können hier auch sehr helfen!
	\end{itemize}
\end{frame}

% Fazit und Ausblick
\begin{frame}{Wie geht es weiter?}
	\begin{itemize}
		\item binäre Klassifikation, ein PA ist simpelster Fall
		\item in Praxis eher mehrere PAs und vielfältige Aufgaben\\ $\rightarrow$ regression, unsupervised learning, ...
		\item SQF Datensatz in Fairness Literatur in vielen weiteren Fragen untersucht \cite{RambachanBBOEFW}, \cite{Kallus2018RUFMLPDa}, \cite{goel2016}
	\end{itemize}
	\vspace*{1cm}
	\text{Fazit:} \\ Fairness ist ein komplexes Thema, das Zusammenarbeit vieler Disziplinen erfordert \\ Es gibt (noch) nicht, die \textbf{eine} Definition von Fairness
\end{frame}

\begin{frame}[allowframebreaks]
	\frametitle{References}
	\bibliographystyle{plain}
	\bibliography{../literature.bib}
\end{frame}

% Extra slides
\section{Extra Folien}

% Weitere Resourcen
\begin{frame}{Ressourcen für Fairness in Machine Learning}
    \begin{itemize}
        \item Interaktives Tool: \url{https://research.google.com/bigpicture/attacking-discrimination-in-ml/}
        \item Einführung in Fairness mit mlr3.fairness: \url{https://journal.r-project.org/articles/RJ-2023-034/}
        \item Fairness and Machine Learning Buch: \url{https://fairmlbook.org/}
    \end{itemize}
\end{frame}


% Weitere Infos zu den Daten
\begin{frame}{POC werden überproportional häufig gestoppt}
    \text{Verteilung der Ethnie in NYC (2023)} \\
    \url{https://www.census.gov/quickfacts/newyorkcitynewyork}

    \vspace{0.3cm}  % Add some space before the table
	% add a title above the table

    \begin{table}
        \centering  % Center the table
		\caption{Verteilung der Ethnie in SQF Daten}
        \begin{tabular}{ll}
            \toprule
            race & prop \\
            \midrule
            \color{orange}{BLACK} & 58.61\% \\
            \color{orange}{WHITE HISPANIC} & 20.32\% \\
            \color{orange}{BLACK HISPANIC} & 10.13\% \\
            WHITE & 5.48\% \\
            OTHER & 2.67\% \\
            NA & 2.79\% \\
            \bottomrule
        \end{tabular}
    \end{table}
\end{frame}

% Kausale Fairness
\begin{frame}{Ist die Gruppenzugehörigkeit der Grund für die Festnahme? \\ - kausale Definitionen}
    \begin{columns}
        \column{0.4\textwidth}
        \centering
		\begin{tikzpicture}[node distance=3cm, >=stealth', thick]
			% Nodes
			\node (Race) [circle, draw, fill=blue!20] {Race};
			\node (Precinct) [circle, draw, fill=yellow!20, right of=Race] {Precinct};
			\node (Arrest) [circle, draw, fill=red!20, below of=Precinct] {Arrest};
		
			% Arrows
			\draw[->] (Race) -- (Arrest);
			\draw[->] (Precinct) -- (Arrest);
		\end{tikzpicture}
		
        \column{0.4\textwidth}
        \centering
        {\small
        \begin{tabular}{|c|c|c|c|}
            \hline
            Race & Precinct & Prior Offenses & Arrest \\
            \hline
            Black & 1 & Yes & Yes \\
            White & 2 & No & No \\
            Hispanic & 1 & Yes & No \\
            Asian & 3 & No & No \\
            \hline
        \end{tabular}
        }
    \end{columns}
\end{frame}


\end{document}


